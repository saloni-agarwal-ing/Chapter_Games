<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Web Game Client</title>
  <style>
    body { font-family: sans-serif; }
    #scoreboard { margin-top: 1em; }
  </style>
</head>
<body>
  <h1>Web Game Client</h1>
  <div>
    <label>Player Name: <input id="playerName" type="text" value="Player" /></label>
    <button id="joinBtn">Join Game</button>
  </div>
  <div id="game" style="display:none;">
    <button onclick="sendAction()">Send Action (Increment Score)</button>
    <div id="scoreboard"></div>
  </div>
  <script>
    let ws;
    let myId;
    document.getElementById('joinBtn').onclick = function() {
      ws = new WebSocket('ws://localhost:8887');
      ws.onopen = function() {
        ws.send(JSON.stringify({type: 'join', playerName: document.getElementById('playerName').value}));
        document.getElementById('joinBtn').disabled = true;
        document.getElementById('playerName').disabled = true;
      };
      ws.onmessage = function(event) {
        const msg = JSON.parse(event.data);
        if (msg.type === 'welcome') {
          myId = msg.playerId;
          document.getElementById('game').style.display = '';
        } else if (msg.type === 'state') {
          updateScoreboard(msg.scoreboard, msg.playerNames);
        }
      };
      ws.onclose = function() {
        alert('Disconnected from server');
        location.reload();
      };
    };
    function sendAction() {
      ws.send(JSON.stringify({type: 'action', playerId: myId, action: 'increment'}));
    }
    function updateScoreboard(scoreboard, playerNames) {
      let html = '<h2>Scoreboard</h2><ul>';
      for (const [id, score] of Object.entries(scoreboard)) {
        const name = playerNames && playerNames[id] ? playerNames[id] : id;
        html += `<li>${name}: ${score}</li>`;
      }
      html += '</ul>';
      document.getElementById('scoreboard').innerHTML = html;
    }
  </script>
</body>
</html>
