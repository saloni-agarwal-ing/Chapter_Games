<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Web Game Client</title>
  <style>
    body { font-family: sans-serif; }
    #scoreboard { margin-top: 1em; }
  </style>
</head>
<body>
  <h1>Web Game Client</h1>
  <div>
    <label>Player Name: <input id="playerName" type="text" value="Player" /></label>
    <button id="joinBtn">Join Game</button>
  </div>
  <div id="game" style="display:none;">
    <h3>Use arrow keys or buttons to move your bucket</h3>
    <button onclick="sendMove('left')">Move Left</button>
    <button onclick="sendMove('right')">Move Right</button>
    <div id="scoreboard"></div>
  </div>
  <script>
    let ws;
    let myId;
    document.getElementById('joinBtn').onclick = function() {
      // For Render.com deployment, use the secure WebSocket protocol (wss://) on default port
      // Render automatically maps external port 443 to your internal PORT environment variable
      const wsUrl = window.location.protocol === 'https:' ?
        'wss://' + window.location.host :
        'ws://' + window.location.hostname + (window.location.hostname === 'localhost' ? ':10000' : '');

      console.log('Connecting to WebSocket:', wsUrl);
      ws = new WebSocket(wsUrl);
      ws.onopen = function() {
        ws.send(JSON.stringify({type: 'join', playerName: document.getElementById('playerName').value}));
        document.getElementById('joinBtn').disabled = true;
        document.getElementById('playerName').disabled = true;
      };
      ws.onmessage = function(event) {
        const msg = JSON.parse(event.data);
        if (msg.type === 'welcome') {
          myId = msg.playerId;
          document.getElementById('game').style.display = '';
        } else if (msg.type === 'gameState') {
          updateScoreboard(msg.scoreboard, msg.playerNames);
        }
      };
      ws.onclose = function() {
        alert('Disconnected from server');
        location.reload();
      };
    };

    function sendMove(direction) {
      if (ws && ws.readyState === WebSocket.OPEN) {
        ws.send(JSON.stringify({type: 'move', direction: direction}));
      }
    }

    // Add keyboard controls
    document.addEventListener('keydown', function(event) {
      if (myId && ws && ws.readyState === WebSocket.OPEN) {
        if (event.key === 'ArrowLeft' || event.key === 'a' || event.key === 'A') {
          sendMove('left');
        } else if (event.key === 'ArrowRight' || event.key === 'd' || event.key === 'D') {
          sendMove('right');
        }
      }
    });

    function updateScoreboard(scoreboard, playerNames) {
      let html = '<h2>Scoreboard</h2><ul>';
      for (const [id, score] of Object.entries(scoreboard)) {
        const name = playerNames && playerNames[id] ? playerNames[id] : id;
        html += `<li>${name}: ${score}</li>`;
      }
      html += '</ul>';
      document.getElementById('scoreboard').innerHTML = html;
    }
  </script>
</body>
</html>
