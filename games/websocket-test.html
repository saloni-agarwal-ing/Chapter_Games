<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>WebSocket Connection Test</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    .test-result { margin: 10px 0; padding: 10px; border-radius: 4px; }
    .success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
    .error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
    .info { background-color: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
    #log { background-color: #f8f9fa; border: 1px solid #dee2e6; padding: 10px; height: 400px; overflow-y: auto; font-family: monospace; white-space: pre-wrap; }
  </style>
</head>
<body>
  <h1>WebSocket Connection Test</h1>
  <div class="info test-result">
    <strong>Testing WebSocket connection to game server...</strong>
  </div>

  <button onclick="testConnection()">Test Connection</button>
  <button onclick="clearLog()">Clear Log</button>

  <h2>Connection Log</h2>
  <div id="log"></div>

  <script>
    function log(message) {
      const logDiv = document.getElementById('log');
      const timestamp = new Date().toLocaleTimeString();
      logDiv.textContent += `[${timestamp}] ${message}\n`;
      logDiv.scrollTop = logDiv.scrollHeight;
    }

    function testConnection() {
      log('=== Starting WebSocket Connection Test ===');
      log(`Current URL: ${window.location.href}`);
      log(`Protocol: ${window.location.protocol}`);
      log(`Host: ${window.location.host}`);

      const wsUrl = window.location.protocol === 'https:' ?
        'wss://' + window.location.host :
        'ws://' + window.location.hostname + (window.location.hostname === 'localhost' ? ':10000' : '');

      log(`Attempting to connect to: ${wsUrl}`);

      try {
        const ws = new WebSocket(wsUrl);

        ws.onopen = function() {
          log('‚úÖ WebSocket connection opened successfully');
          log('Sending test message...');
          ws.send(JSON.stringify({type: 'join', playerName: 'TestPlayer'}));
        };

        ws.onmessage = function(event) {
          log(`üì® Message received: ${event.data}`);
          try {
            const msg = JSON.parse(event.data);
            log(`üì¶ Parsed message: ${JSON.stringify(msg, null, 2)}`);
          } catch (e) {
            log(`‚ùå Failed to parse message as JSON: ${e.message}`);
          }
        };

        ws.onerror = function(error) {
          log(`‚ùå WebSocket error: ${error}`);
        };

        ws.onclose = function(event) {
          log(`üîå WebSocket closed - Code: ${event.code}, Reason: ${event.reason}, Clean: ${event.wasClean}`);

          if (event.code === 1006) {
            log('‚ùå Connection failed - Code 1006 indicates connection could not be established');
          } else if (event.code === 1011) {
            log('‚ùå Server error - Code 1011 indicates internal server error');
          } else if (event.code === 1000) {
            log('‚úÖ Connection closed normally');
          }
        };

        // Set a timeout to close connection after testing
        setTimeout(() => {
          if (ws.readyState === WebSocket.OPEN) {
            log('‚è∞ Test timeout - closing connection');
            ws.close();
          }
        }, 10000);

      } catch (error) {
        log(`‚ùå Exception creating WebSocket: ${error.message}`);
      }
    }

    function clearLog() {
      document.getElementById('log').textContent = '';
    }

    // Auto-run test on page load
    window.onload = function() {
      log('Page loaded, ready to test connection');
      testConnection();
    };
  </script>
</body>
</html>

